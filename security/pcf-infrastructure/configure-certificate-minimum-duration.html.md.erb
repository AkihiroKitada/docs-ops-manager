---
title: Configuring Minimum Duration for Certificates
owner: Ops Manager
---

This topic describes how to set a minimum duration for certificate authority (CA) and leaf certificates managed by <%= vars.ops_manager %> and CredHub.

## <a id='overview'></a> Overview

By default, <%= vars.ops_manager %> and CredHub generate certificates using the duration requested by the product that creates the certificate. This duration can vary from product to product.
In <%= vars.ops_manager %> v2.10.17 and later, you can set a minimum duration for CA and leaf certificates.

If you enable this feature, when a product requests that a certificate be generated with a shorter duration than the configured minimum, the certificate is generated with the minimum duration you set instead.
If the product requests that a certificate be generated with a longer duration than the configured minimum, the certificate is generated with the longer duration.

For example, <%= vars.app_runtime %> might create a leaf certificate with a duration of 365 days.
If an operator configures the minimum leaf duration to be 730 days, then when <%= vars.app_runtime %> is first deployed or regenerated, the leaf certificate is created using a duration of 730 days instead.
A <%= vars.app_runtime %> certificate that is normally created with a duration of 1460 days continues to be created with a duration of 1460 days.

## <a id='configure'></a> Configuring the Minimum Certificate Duration

To enable the minimum certificate duration feature:

1. Click the **BOSH Director** tile.
1. Select **Director Config**.
1. Scroll down to the **Set Minimum Certificate Duration** section.
1. Select **On**.
1. Enter a minimum duration for CA certificates in the **CA Certificate Validity Duration** field.
1. Enter a minimum duration for leaf certificates in the **Leaf Certificate Validity Duration** field.
1. Click **Save**.

After enabling the minimum duration feature, you must take additional steps to apply the setting to existing certificates, as well as any new certificates generated by CredHub.
Depending on your deployment, continue to one of the following sections:

- [Applying Minimum Certificate Duration on an Existing <%= vars.ops_manager %>](#apply-existing)
- [Applying Minimum Certificate Duration on a New <%= vars.ops_manager %>](#apply-new)

### <a id='apply-existing'></a> Applying Minimum Certificate Duration on an Existing <%= vars.ops_manager %>

This procedure describes how to apply the minimum certificate duration on an existing <%= vars.ops_manager %>.

To apply the minimum certificate duration:

1. Click **Apply Changes** on the BOSH Director. This ensures that future certificates generated by CredHub use the new minimum duration settings.
1. To apply the minimum duration to leaf certificates, you must do a leaf certificate rotation:
    1. To rotate non-configurable leaf certificates, see [Rotating Non-Configurable Leaf Certificates](rotate-non-configurable-certs.html).
    1. To rotate certificates generated using **Generate RSA Certificate**, see [Rotating Configurable Leaf Certificates](rotate-configurable-certs.html).
1. To apply the minimum durations to both CA and leaf certificates, you must do a full CA rotation. To rotate CAs and leaf certificates, see [Rotating CAs and Leaf Certificates](rotate-cas-and-leaf-certs.html).
1. By default, the Services TLS CA is excluded by the <%= vars.ops_manager %> certificate rotation API. You can rotate this certificate separately to apply the minimum duration. To rotate the Services TLS CA, see [Rotate the Services TLS CA and Its Leaf Certificates](advanced-certificate-rotation.html#services-rotation).

### <a id='apply-new'></a> Applying Minimum Duration on a New <%= vars.ops_manager %>

This procedure describes how to apply the minimum certificate duration on a new <%= vars.ops_manager %>.

<p class="note"><strong>Note:</strong> If you have run <strong>Apply Changes</strong> on the BOSH Director tile, see <a href="#apply-existing">Applying Minimum Certificate Duration on an Existing <%= vars.ops_manager %></a> above.</p>

To apply the minimum certificate duration:

1. To apply the minimum duration to leaf certificates, no action is required. Leaf certificates are created using the appropriate duration the first time you run **Apply Changes**.
1. To apply the minimum duration to CA certificates, you must regenerate the CA certificates. Follow the procedure in [Rotating CAs and Leaf Certificates](rotate-cas-and-leaf-certs.html) with the following modifications:
    1. You do not need to enable the **Recreate VMs deployed by the BOSH Director** checkbox.
    1. You do not need to run **Apply Changes**.

## <a id='excluded-certs'></a> Excluded Certificates

This section describes the certificates that are excluded from the minimum duration setting.
The minimum duration setting only applies to certificates that are rotated by the <%= vars.ops_manager %> certificate rotation procedures.

Certificates that do not use the minimum duration setting include the following:

The following certificates do not use the minimum duration setting:

* **User-provided certificates:** Products installed using <%= vars.ops_manager %> can contain fields that request operator-provided certificates. These certificates do not have the minimum duration enforced because they are not generated by <%= vars.ops_manager %> or CredHub. You can use **Generate RSA Certificate** to generate a certificate instead of requiring an operator-provided certificate. Certificates generated with **Generate RSA Certificate** use the minimum certificate duration you set.

* **<%= vars.ops_manager %> SAML Certificate:** If you configure <%= vars.ops_manager %> to use SAML, UAA uses the <%= vars.ops_manager %> SAML Certificate. This certificate is valid for 730 days, and is not rotated by the same procedure that rotates other certificates. To rotate this certificate, see [How to check and rotate Ops Manager SAML Certificate before it expires](https://community.pivotal.io/s/article/how-to-check-and-rotate-ops-manager-saml-certificate-before-it-expires) in the VMware Tanzu Support documentation.

* **<%= vars.ops_manager %> SSL Certificate:** The <%= vars.ops_manager %> SSL Certificate is used to secure communication between the operator's browser and the <%= vars.ops_manager %> app. By default, this is a self-signed certificate created when the <%= vars.ops_manager %> VM is first launched. This certificate is valid for 365 days, and is automatically regenerated when upgrading <%= vars.ops_manager %>.

* **NATS client certificates:** Each BOSH-deployed VM has a unique NATS client certificate used to communicate with the BOSH Director. This certificate is regenerated each time the VM is re-created.

* **Diego identity certificates:** Each app instance deployed within <%= vars.app_runtime %> has a unique identity certificate used to communicate with Diego. The Diego Cell rep supplies a new certificate and private keypair to the app instance before the end of the validity period. For more information, [Using Instance Identity Credentials](https://docs.pivotal.io/application-service/<%= vars.current_major_version.sub('.','-') %>/devguide/deploy-apps/instance-identity.html) VMware Tanzu Support documentation.
