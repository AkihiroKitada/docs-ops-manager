---
title: Configuring Minimum Duration for Certificates
owner: Ops Manager
---

This topic describes how to set a minimum duration for certificates managed by <%= vars.ops_manager %> and CredHub.

## <a id='overview'></a> Overview

By default, certificates generated by <%= vars.ops_manager %> and CredHub will be generated using the duration requested by the product creating the certificate. This can vary from product to product. <%= vars.ops_manager %> v2.10.17 introduces a feature that allows you to set a minimum duration for CA and leaf certificates. Once this feature is enabled, if a product requests a certificate be generated with a duration lower than the configured minimum duration, the certificate will be generated with the minimum duration instead. If the product requests a certificate be generated with a duration higher than the configured minimum duration, the certificate will be generated with the requested duration.

For example, <%= vars.app_runtime %> may create a leaf certificate with a duration of 365 days. When an operator has configured the minimum leaf duration to be 730 days, then when <%= vars.app_runtime %> is first deployed or regenerated, the leaf certificate will be created using a duration of 730 days instead. A <%= vars.app_runtime %> certificate that would normally be created with a duration of 1460 days would continue to be created with a duration of 1460 days.

## <a id='configure'></a> Configuring the Minimum Durations

To enable the minimum duration feature:

1. Click the **BOSH Director** tile.
1. Select **Director Config**.
1. Scroll down to the **Customize Certificate Duration** section.
1. Select the **On** option.
1. Enter the desired minimum duration for CA certificates in the **CA Certificate Validity Duration** field.
1. Enter the desired minimum duration for leaf certificates in the **Leaf Certificate Validity Duration** field.
1. Click **Save**.

After enabling the minimum duration feature, you must take additional steps to apply the setting to existing certificates, as well as any new certificates generated by CredHub.

###<a id='apply-existing'></a> Applying Minimum Duration on an Existing <%= vars.ops_manager %>

This procedure describes how to apply the minimum duration on an already existing <%= vars.ops_manager %>.

1. Apply Changes on the BOSH Director. This ensures that future certificates generated by CredHub will use the new minimum durations.
1. To apply the minimum duration to leaf certificates, you must do a leaf certificate rotation.
    1. To rotate non-configurable leaf certificates, see [Rotating Non-Configurable Leaf Certificates](rotate-non-configurable-certs.html).
    1. To rotate certificates generated using the "Generate RSA Certificate" button, see [Rotating Configurable Leaf Certificates](rotate-configurable-certs.html)
1. To apply the minimum durations to both CA and leaf certificates, you must do a full CA rotation. To rotate CAs and leaf certificates, see [Rotating CAs and Leaf Certificates](rotate-cas-and-leaf-certs.html).
1. By default, the Services TLS CA is excluded by the <%= vars.ops_manager %> certificate rotation API. It is possible to rotate this certificate separately in order to apply the minimum duration. To rotate the Services TLS CA, see [Rotate the Services TLS CA and Its Leaf Certificates](advanced-certificate-rotation.html#services-rotation).

###<a id='apply-new'></a> Applying Minimum Duration on a New <%= vars.ops_manager %>

This procedure describes how to apply the minimum duration on a new <%= vars.ops_manager %>.

<p class="note warning"><strong>Warning:</strong> If you have done an Apply Changes on the BOSH Director tile, you <strong>must</strong> use the procedure described by <a href="#apply-existing">Applying Minimum Duration on an Existing <%= vars.ops_manager %></a> instead.</p>

1. To apply the minimum duration to leaf certificates, no action is required. Leaf certificates will be created using the appropriate duration during the first Apply Changes.
1. To apply the minimum duration to CA certificates, you must regenerate the CA certificates. This can be done by following the procedure described by [Rotating CAs and Leaf Certificates](rotate-cas-and-leaf-certs.html) with the following modifications:
    1. You do not need to enable the **Recreate VMs deployed by the BOSH Director** checkbox.
    1. You do not need to run Apply Changes.

## <a id='excluded-certs'></a> Excluded Certificates

The minimum duration setting only applies to certificates that are rotated by the <%= vars.ops_manager %> certificate rotation procedures. Certificates that do not use the minimum duration setting include:

* **User-provided certificates:** Products installed using <%= vars.ops_manager %> can contain fields that request operator-provided certificates. These certificates do not have the minimum duration enforced because they are not generated by <%= vars.ops_manager %> or CredHub. These fields also provide a "Generate RSA Certificate" button which can be used to generate a certificate instead of requiring an operator-provided certificate. Certificates generated using the "Generate RSA Certificate" button will have the minimum duration enforced.

* **<%= vars.ops_manager %> SSL Certificate:** The <%= vars.ops_manager %> SSL Certificate is used to secure communication between the operator's browser and the <%= vars.ops_manager %> application. By default, this is a self-signed certificate created when the <%= vars.ops_manager %> VM is first launched. This certificate is valid for 365 days, and is automatically regenerated when upgrading <%= vars.ops_manager %>.

* **NATS client certificates:** Each BOSH-deployed VM has a unique NATS client certificate used to communicate with the BOSH Director. This certificate is regenerated each time the VM is recreated.

* **Diego identity certificates:** Each app instance deployed within <%= vars.app_runtime %> has a unique identity certificate used to communicate with Diego. The Diego cell rep supplies a new certificate and private key pair to the app instance before the end of the validity period. See [Using Instance Identity Credentials](https://docs.pivotal.io/application-service/<%= vars.current_major_version.sub('.','-') %>/devguide/deploy-apps/instance-identity.html) for more details.
