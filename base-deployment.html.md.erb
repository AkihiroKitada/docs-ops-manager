---
breadcrumb: Pivotal Cloud Foundry Documentation
title: PCF Base Reference Architecture
owner: Customer0
---

This topic describes the base reference architectures for installing Pivotal Cloud Foundry (PCF) on any infrastructure, to support the following runtimes:

- Pivotal Application Service (PAS)
- Pivotal Container Service (PKS)

For infrastructure-specific reference architectures that build on this common base architecture, see the following topics:

- [Reference Architecture for PCF on AWS](./aws/aws_ref_arch.html)
- [Reference Architecture for PCF on Azure](./azure/azure_ref_arch.html)
- [Reference Architecture for PCF on GCP](./gcp/gcp_ref_arch.html)
- [Reference Architecture for PCF on OpenStack](./openstack/openstack_ref_arch.html)
- [Reference Architecture for PCF on vSphere](./vsphere/vsphere_ref_arch.html)

## <a id="overview"></a>Overview

A Pivotal Cloud Foundry (PCF) reference architecture describes a proven
approach for deploying PCF on a specific IaaS, such
as AWS, Azure, GCP, OpenStack, or vSphere.
PCF reference architectures meet the following requirements:

  - Secure
  - Publicly-accessible
  - Includes common PCF-managed services such as MySQL, RabbitMQ, and
    Spring Cloud Services
  - Can host at least 100 app instances, or far more

You can use PCF reference architectures to help plan the best configuration for your PCF deployment on your IaaS.

Pivotal has validated the following PCF products on its own deployments
based on these reference architectures:

  - Pivotal Cloud Foundry Ops Manager
  - Pivotal Application Service (PAS)
  - Pivotal Container Services (PKS)

## <a id="pas"></a>PAS Architecture

The following diagram shows a base architecture for PAS, and how its network topology places and replicates PCF and PAS components across subnets and Availability Zones.

<%# Image from PAS_Base canvas of /images/v2/PCF_Reference_Architecture_2019.graffle %>
![PAS Base Deployment Topology](./images/v2/export/PAS_Base.png)

[View a larger version of this diagram](./images/v2/export/PAS_Base.png)

### <a id="pas-components"></a>Internal Components

The following table describes the internal component placements shown in the diagram above:

| **Component**           | **Placement and Access Notes**                                                                                                                                         |
|---------------------- |----------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Ops Manager**         | Deployed on one of the three public subnets.  Accessible by FQDN or through an optional jumpbox.                                                                       |
| **BOSH Director**       | Deployed on the infrastructure subnet.                                                                                                                                   |
| **Jumpbox**            | Optional. Deployed on the infrastructure subnet for accessing PAS management components such as Ops Manager and the Cloud Foundry command-line interface (cf CLI).                                            |
| **Gorouters** (HTTP routers in CF)          | Deployed on all three PAS subnets, one per Availability Zone (AZ).<br \>  Accessed through the HTTP, HTTPS, and SSL load balancers.                          |
| **Diego Brain**        | Deployed on all three PAS subnets, one per AZ.<br \>  The Diego Brain component is required, but SSH container access support through the Diego Brain is optional, and enabled through the SSH load balancers.  |
| **TCP Routers**         | Optional. Deployed on all three PAS subnets, one per AZ, to support TCP routing.                                                                                         |
| **Service Tiles**       | Service brokers and shared services instances are deployed to the Services subnet.<br \>  Dedicated on-demand service instances are deployed to an On-demand services subnet.          |
| **Isolation Segments**  | Deployed on an Isolation Segment subnet.  Includes Diego Cells and Gorouters for running and accessing apps hosted within isolation segments.                             |

### <a id="pas-network"></a>Networks

#### <a id="pas-subnets"></a>Required Subnets

PAS requires a number of statically-defined networks to host the main
elements it’s composed of.

  - Infrastructure subnet - `/24` segment  
    This subnet contains VMs that require access only for Platform Administrators, for example Ops Manager, the BOSH Director and an optional jumpbox.
  - PAS subnet - `/24` segment  
    This subnet contains PAS runtime VMs, such as Gorouters, Diego Cells and Cloud Controllers.
  - Services subnet - `/24` segment  
    The Services network is handy for use with Ops Manager tiles that
    you might add in addition to PAS. You can think of the Services
    network as the “everything else not PAS” network. Some of these
    tiles can call for additional network capacity to grow into on
    demand, so it is recommended that you consider adding an “On-Demand”
    network per tile that would need this and pair them up in the tile’s
    config.
  - On-demand Services subnet(s) - `/24` segments  
    Example: Redis tile asks for “Network” and “Services Network”. The
    first one is for placing the broker and the second one is for
    deploying worker VMs to support the service. For this, we would
    deploy a new network “OD-Services1” and tell Redis to use the
    “Services” network for the broker and the “OD-Services1” network
    for the workers. The next tile can also use “Services” for the
    broker and a new “OD-Services2” network for workers, and so on.
  - Isolation Segments subnet(s) - `/24` segments  
    Example: Isolation Segments can be added quickly and easily to an
    existing PAS installation. This range of address space is designated
    for use when adding one of more of them. A new /24 network for this
    range should be deployed for each new Isolation Segment. There’s
    reserved capacity for \>50 Isolation Segments of \>250 VMs per in
    this address bank.

#### <a id="pas-lb"></a>Load Balancing

In general, a suitable load balancer must be found to send incoming
HTTP, HTTPS,SSH and SSL traffic to the Gorouters and application
containers when applicable. All installations approaching Production
level use with make use of external load balancing from hardware
appliance vendors or other network-layer solutions.

The load balancer can also function as Layer 4 or Layer 7 load balancing
function. SSL can be terminated at the load balancer or used as a
pass-through to Gorouter.

Common deployments of load balancing in PAS are:

  - HTTP/HTTPS traffic to/from Gorouters
  - TCP traffic to/from TCP routers
  - Diego Brains for when application container SSH access is desired

Global Load Balancer for multiple PAS foundations can be achieved with
vendor specific Global Traffic Manager or Global DNS load balancer.

For additional information, see [Global DNS Load Balancers for Multi-Foundation Environments](./global-dns-lb.html).

### <a id="pas-ha"></a>High Availability

PAS isn’t considered High Availability (HA) until it runs across at least two Availability Zones (AZs).
Pivotal recommends defining three AZs.

On IaaSes with their own HA capabilities, using the IaaS HA in conjunction with a PCF HA topology provides the best of both worlds.
Multiple AZs give PCF redundancy, so that losing an AZ isn’t catastrophic.
The BOSH Resurrector can then replace lost VMs as needed to repair a foundation.

To back up and restore a foundation externally, use [BOSH Backup and Restore](https://docs.cloudfoundry.org/bbr/) (BBR).

### <a id="pas-storage"></a>Storage

PAS requires persistent storage disks to store its state (database) and to allocated as ephemeral disks to its components.
For details on storage configuration and capacity planning, refer to the corresponding chapter for the specific IaaS.

The platform also requires the configuration of file storage. For more details refer to [Configuring File Storage for PAS](../customizing/pas-file-storage.html).

### <a id="pas-security"></a>Security

See the topics below for how PAS implements security:

* [PCF Infrastructure Security
](../security/pcf-infrastructure/index.html)

* [Security Concepts](../security/concepts/)

* [Certificates and TLS in PCF](../security/pcf-infrastructure/certificates-index.html)

* [Network Communication Paths in PCF](../security/networking/#net_commpaths) - includes firewall ports

### <a id="pas-domains"></a>Domain Names

PAS requires following domain names to be registered:

- System domain, for PAS and other tiles: `sys.domain.name`
- App domain, for your applications: `app.domain.name`

You must also define the following wildcard domain names and include them when creating certificates that access PAS and its hosted apps:

  - \*.SYSTEM-DOMAIN
  - \*.APPS-DOMAIN
  - \*.login.SYSTEM-DOMAIN
  - \*.uaa.SYSTEM-DOMAIN

### <a id="pas-scaling"></a>Component Scaling

See [Scaling PAS](../opsguide/scaling-ert-components.html) for recommendations on how to scale PAS for different deployment scenarios.

## <a id="pks-topology"></a>PKS Architecture

The following diagram shows a base architecture for PKS, and how its network topology places and replicates PCF and PKS components across subnets and Availability Zones.

<%# Image from PKS_Base canvas of /images/v2/PCF_Reference_Architecture_2019.graffle %>
![PAS Base Deployment Topology](./images/v2/export/PKS_Base.png)

[View a larger version of this diagram](./images/v2/export/PKS_Base.png)

### <a id="pks-components"></a>Internal Components

The following table describes the internal component placements shown in the diagram above:

| **Component**           | **Placement and Access Notes**                                                                                                                                         |
|---------------------- |----------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Ops Manager**         | Deployed on one of the subnets. Accessible by fully-qualified domain name (FQDN) or through an optional jumpbox.   |
| **BOSH Director**         | Deployed on the infrastructure subnet.   |
| **Jumpbox**         | Optional. Deployed on the infrastructure subnet for accessing PKS management components such as Ops Manager and the PKS + Kubectl command-line interface.   |
| **PKS API**         | Deployed as a service broker VM on the PKS Services subnet.  Handles PKS API and service adapter requests, and manages PKS clusters.  For more information, see [Pivotal Container Service (PKS)](https://docs.pivotal.io/runtimes/pks/index.html#components) |
| **Harbor Tile**         | Optional container images registry, typically deployed to the Services subnet.   |
| **PKS Cluster**         | Deployed to a dynamically-created, dedicated PKS cluster subnet. Each cluster consists of worker nodes that run the workloads (applications) and one or more master nodes.   |

### <a id="pks-network"></a>Networks

#### <a id="pks-subnets"></a>Subnets Requirements

PKS requires two defined networks to host the main elements it’s
composed of.

  - Infrastructure subnet - `/24`  
    Contains VMs that require access only for Platform Administrators, for example Ops Manager, BOSH Director and an optional jumpbox.
  - PKS Services subnet - `/24`  
    Hosts PKS API VM and other optional service tiles such as
    Harbor.
  - PKS Clusters subnets - each one a `/24` from a pool of pre-allocated IPs  
    Hosts PKS clusters.

#### <a id="pks-lb"></a>Load Balancing

Load balancers can be used to manage traffic across master nodes of a PKS cluster or for deployed workloads. For more information on how to configure load balancers for PKS, refer to the corresponding documentation for the specific IaaS.

### <a id="pks-ha"></a>High Availability

PKS has no inherent HA capabilities to design for. Make the best efforts
to have HA design at the IaaS, storage, power and access layers to
support PKS.

### <a id="pks-storage"></a>Storage

PKS requires shared storage across all Availability Zones for the
deployed workloads to appropriately allocate their required storage.

**Capacity**

TBD: any generic notes on storage and capacity planning? Or leave it to
IaaS specific sections only?

### <a id="pks-security"></a>Security

See the topics below for how PKS implements security:

* [Enterprise PKS Security](https://docs.pivotal.io/runtimes/pks/security.html)

* [Firewall Ports](https://docs.pivotal.io/runtimes/pks/ports-protocols-nsx-t.html)

### <a id="pks-domains"></a>Domain Names

PKS requires the following domain names to be registered when creating a
wildcard certificate and PKS tile configurations: `*.pks.domain.name`

The wildcard certificate covers both the PKS API domain e.g. `api.pks.domain.name` and the PKS Clusters
domains e.g. `mycluster.pks.domain.name`.

### <a id="pks-management"></a>Cluster Management

See [Managing Clusters](https://docs.pivotal.io/runtimes/pks/managing-clusters.html) for recommendations on managing Enterprise PKS clusters.
